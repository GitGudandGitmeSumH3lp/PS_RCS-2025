<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YDLidar S2PRO Monitor - HTML</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00ff88;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .lidar-container {
            position: relative;
            width: 600px;
            height: 600px;
            margin: 0 auto;
            background: rgba(0,0,0,0.2);
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        #lidarCanvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .control-btn.active {
            background: linear-gradient(45deg, #00ff88, #00d4aa);
        }
        
        .status {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status.scanning {
            color: #00ff88;
        }
        
        .status.stopped {
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>YDLidar S2PRO Monitor</h1>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="pointCount">0</div>
                <div class="stat-label">Points</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="frameCount">0</div>
                <div class="stat-label">Frame</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="frequency">5</div>
                <div class="stat-label">Hz</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="range">12.0</div>
                <div class="stat-label">Max Range (m)</div>
            </div>
        </div>
        
        <div class="lidar-container">
            <canvas id="lidarCanvas" width="600" height="600"></canvas>
        </div>
        
        <div class="controls">
            <button class="control-btn active" id="startBtn" onclick="toggleScanning()">Start Scanning</button>
            <button class="control-btn" onclick="clearData()">Clear</button>
            <button class="control-btn" onclick="toggleIntensity()">Toggle Intensity</button>
            <button class="control-btn" onclick="generateDemoData()">Demo Data</button>
        </div>
        
        <div class="status scanning" id="status">Ready to scan - Waiting for data...</div>
    </div>

    <script>
        const canvas = document.getElementById('lidarCanvas');
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const maxRadius = Math.min(centerX, centerY) - 30;
        const RMAX = 12.0;
        
        let isScanning = false;
        let showIntensity = true;
        let frameCount = 0;
        let currentData = [];
        let animationId = null;

        // Color palette for intensity visualization (plasma colormap approximation)
        function getIntensityColor(intensity) {
            const normalized = Math.min(Math.max(intensity / 255, 0), 1);
            
            if (normalized < 0.25) {
                const t = normalized / 0.25;
                return {
                    r: Math.floor(13 + t * (62 - 13)),
                    g: Math.floor(8 + t * (4 - 8)),
                    b: Math.floor(135 + t * (156 - 135))
                };
            } else if (normalized < 0.5) {
                const t = (normalized - 0.25) / 0.25;
                return {
                    r: Math.floor(62 + t * (99 - 62)),
                    g: Math.floor(4 + t * (0 - 4)),
                    b: Math.floor(156 + t * (140 - 156))
                };
            } else if (normalized < 0.75) {
                const t = (normalized - 0.5) / 0.25;
                return {
                    r: Math.floor(99 + t * (182 - 99)),
                    g: Math.floor(0 + t * (54 - 0)),
                    b: Math.floor(140 + t * (75 - 140))
                };
            } else {
                const t = (normalized - 0.75) / 0.25;
                return {
                    r: Math.floor(182 + t * (252 - 182)),
                    g: Math.floor(54 + t * (206 - 54)),
                    b: Math.floor(75 + t * (16 - 75))
                };
            }
        }

        function drawPolarGrid() {
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 1;
            
            // Draw concentric circles (range rings)
            const ranges = [2, 4, 6, 8, 10, 12];
            ranges.forEach(range => {
                const radius = (range / RMAX) * maxRadius;
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.stroke();
                
                // Range labels
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.font = '12px Arial';
                ctx.fillText(`${range}m`, centerX + radius - 15, centerY - 5);
            });
            
            // Draw angle lines (every 30 degrees)
            for (let angle = 0; angle < 360; angle += 30) {
                const radians = (angle * Math.PI) / 180;
                const x = centerX + Math.cos(radians - Math.PI/2) * maxRadius;
                const y = centerY + Math.sin(radians - Math.PI/2) * maxRadius;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // Angle labels
                const labelX = centerX + Math.cos(radians - Math.PI/2) * (maxRadius + 15);
                const labelY = centerY + Math.sin(radians - Math.PI/2) * (maxRadius + 15);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${angle}°`, labelX, labelY);
            }
        }

        function drawLidarData(data) {
            data.forEach(point => {
                const { angle, range, intensity } = point;
                
                // Convert polar to cartesian coordinates
                // Adjust angle to match LIDAR convention (0° = North, clockwise)
                const adjustedAngle = angle - Math.PI/2; // North at top
                const radius = Math.min(range / RMAX * maxRadius, maxRadius);
                const x = centerX + Math.cos(adjustedAngle) * radius;
                const y = centerY + Math.sin(adjustedAngle) * radius;
                
                // Set point color based on intensity
                let color;
                if (showIntensity) {
                    const colorData = getIntensityColor(intensity);
                    color = `rgba(${colorData.r}, ${colorData.g}, ${colorData.b}, 0.8)`;
                } else {
                    color = 'rgba(0, 255, 136, 0.8)';
                }
                
                // Draw point
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, y, 3, 0, 2 * Math.PI);
                ctx.fill();
            });
        }

        function render() {
            // Clear canvas
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            drawPolarGrid();
            
            // Draw LIDAR data
            if (currentData.length > 0) {
                drawLidarData(currentData);
                document.getElementById('pointCount').textContent = currentData.length;
            }
            
            // Update frame counter
            if (isScanning) {
                frameCount++;
                document.getElementById('frameCount').textContent = frameCount;
            }
            
            // Continue animation
            if (isScanning) {
                animationId = requestAnimationFrame(render);
            }
        }

        function toggleScanning() {
            isScanning = !isScanning;
            const btn = document.getElementById('startBtn');
            const status = document.getElementById('status');
            
            if (isScanning) {
                btn.textContent = 'Stop Scanning';
                btn.classList.add('active');
                status.textContent = 'Scanning - Waiting for LIDAR data...';
                status.className = 'status scanning';
                render();
            } else {
                btn.textContent = 'Start Scanning';
                btn.classList.remove('active');
                status.textContent = 'Stopped';
                status.className = 'status stopped';
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            }
        }

        function clearData() {
            currentData = [];
            frameCount = 0;
            document.getElementById('pointCount').textContent = '0';
            document.getElementById('frameCount').textContent = '0';
            
            // Clear canvas completely
            ctx.fillStyle = 'rgba(0, 0, 0, 1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            drawPolarGrid();
        }

        function toggleIntensity() {
            showIntensity = !showIntensity;
            document.querySelector('[onclick="toggleIntensity()"]').textContent = 
                showIntensity ? 'Hide Intensity' : 'Show Intensity';
        }

        function generateDemoData() {
            // Generate sample LIDAR data for demonstration
            currentData = [];
            const pointCount = Math.floor(Math.random() * 200) + 160; // 160-360 points
            
            for (let i = 0; i < pointCount; i++) {
                const angle = (Math.random() * 360 - 180) * Math.PI / 180; // -180 to 180 degrees
                const range = Math.random() * 11 + 0.5; // 0.5 to 11.5 meters
                const intensity = Math.floor(Math.random() * 255);
                
                currentData.push({ angle, range, intensity });
            }
            
            // Simulate some obstacles (walls, objects)
            if (Math.random() > 0.5) {
                // Add a wall
                const wallAngle = Math.random() * Math.PI * 2;
                const wallDistance = Math.random() * 8 + 2;
                for (let i = -15; i <= 15; i++) {
                    const angle = wallAngle + (i * Math.PI / 180);
                    currentData.push({ 
                        angle, 
                        range: wallDistance + Math.random() * 0.5, 
                        intensity: Math.floor(Math.random() * 100) + 150 
                    });
                }
            }
        }

        // Simulate receiving data from Python backend
        function simulateDataStream() {
            if (isScanning && Math.random() > 0.7) {
                generateDemoData();
            }
        }

        // Initialize
        clearData();

        // Simulate periodic data updates
        setInterval(simulateDataStream, 200); // Update every 200ms (5Hz)

        // TODO: WebSocket connection to Python backend
        // This is where you would connect to your Python LIDAR script
        /*
        const ws = new WebSocket('ws://localhost:8080');
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.points) {
                currentData = data.points;
            }
        };
        */
    </script>
</body>
</html>