<!-- frontend/templates/service_dashboard.html -->
<!-- 
  PS_RCS_PROJECT
  Copyright (c) 2026. All rights reserved.
 
  File: service_dashboard.html
  Description: Apple/Bento-style dashboard with modal interactions
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PS-RCS Dashboard v{{ app_version }}</title>
  <link rel="stylesheet" href="/static/css/service_theme.css">
</head>
<body data-theme="dark">
  
  <header id="global-status-bar" class="status-bar">
    <div id="connection-indicator" class="status-badge" data-connected="false">CONN: OFFLINE</div>
    <div id="battery-display" class="status-metric" data-voltage="0.0">0.0V</div>
    <button id="theme-toggle" class="icon-button" aria-label="Toggle theme">üåì</button>
  </header>

  <main id="dashboard-grid" class="service-grid bento-grid">
    
    <!-- Contract ¬ß3.1: Camera Preview Card (Top-right position) -->
    <div id="card-camera-preview" class="bento-card">
      <div class="preview-container">
        <div class="camera-placeholder"></div>
        <div class="btn-overlay" role="button" tabindex="0" aria-label="Open camera feed">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <path d="M21 5l-2 2M3 5l2 2m0 0l2-2M7 5v14m0 0l-2 2m2-2l2 2m10-16l-2-2M17 5l2-2m0 16l2 2m-2-2l-2 2m4-14v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span>View Feed</span>
        </div>
      </div>
      <div class="card-footer">
        <div class="status-indicator" data-status="standby">
          <span id="camera-status">Camera Standby</span>
        </div>
        <button id="btn-open-vision" class="btn-secondary" aria-label="Open camera view">Open</button>
      </div>
    </div>
    
    <!-- Existing Vision Card (keep for backward compatibility) -->
    <section id="vision-card" class="bento-card vision-card" data-modal="visionModal" hidden>
      <div class="card-icon">
        <svg class="icon camera-icon" viewBox="0 0 24 24">
          <path d="M4 4h3l2-2h6l2 2h3a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2"></path>
          <circle cx="12" cy="13" r="4"></circle>
        </svg>
      </div>
      <div class="card-text">Vision Ready</div>
      <div class="card-status">
        <span id="vision-status" class="status-indicator" data-status="offline">‚óè</span>
      </div>
    </section>
    
    <!-- Control Card -->
    <section id="control-card" class="bento-card control-card" data-modal="controlModal">
      <div class="card-icon">
        <svg class="icon sliders-icon" viewBox="0 0 24 24">
          <line x1="4" y1="21" x2="4" y2="14"></line>
          <line x1="4" y1="10" x2="4" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12" y2="3"></line>
          <line x1="20" y1="21" x2="20" y2="16"></line>
          <line x1="20" y1="12" x2="20" y2="3"></line>
          <line x1="1" y1="14" x2="7" y2="14"></line>
          <line x1="9" y1="8" x2="15" y2="8"></line>
          <line x1="17" y1="16" x2="23" y2="16"></line>
        </svg>
      </div>
      <div class="card-text">Standby</div>
      <div class="card-status">
        <span id="motor-status" class="module-status-badge" data-status="offline">OFFLINE</span>
      </div>
    </section>
    
    <!-- System Card -->
    <section id="system-card" class="bento-card system-card">
      <div class="card-icon">
        <svg class="icon shield-icon" viewBox="0 0 24 24">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path>
        </svg>
      </div>
      <div class="card-text">System Healthy</div>
      <div class="card-status">
        <span id="system-status" class="module-status-badge" data-status="offline">OFFLINE</span>
      </div>
    </section>

    <!-- Existing OCR Results Card (Hidden in Bento layout) -->
    <section id="scan-results-card" class="dashboard-card" style="display: none;">
      <div class="card-header">
        <h3>üìÑ Last Scan Result</h3>
      </div>
      <div class="card-body">
        <div id="scan-data">
          <p><strong>Tracking ID:</strong> <span id="tracking-id">-</span></p>
          <p><strong>Order ID:</strong> <span id="order-id">-</span></p>
          <p><strong>RTS Code:</strong> <span id="rts-code">-</span></p>
          <p><strong>District:</strong> <span id="district">-</span></p>
          <p><strong>Confidence:</strong> <span id="confidence">-</span></p>
          <p><strong>Time:</strong> <span id="scan-time">-</span></p>
        </div>
      </div>
    </section>

  </main>

  <!-- Contract ¬ß3.2: Vision Modal (Replaces existing) -->
  <dialog id="visionModal" aria-labelledby="modal-title">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">Vision Panel</h2>
        <button id="btn-close-vision" class="btn-close" aria-label="Close modal">√ó</button>
      </div>
      <div class="video-wrapper">
        <img id="video-stream-modal" src="" alt="Live camera feed" crossorigin="anonymous" />
        <div id="stream-error-overlay" class="stream-error" hidden>
          <span>Camera unavailable</span>
        </div>
      </div>
      <div class="modal-controls">
        <button id="btn-scan-trigger" class="btn-primary" disabled>Scan Document</button>
        <p class="scan-hint">Click to extract text from current frame</p>
      </div>
    </div>
  </dialog>

  <!-- Keep existing Control Modal -->
  <dialog id="controlModal" class="bento-modal">
    <div class="modal-content">
      <button class="modal-close" data-close="controlModal">√ó</button>
      <h2>Motor Control</h2>
      <div class="control-panel">
        <div class="control-group">
          <label>Speed</label>
          <input type="range" min="0" max="100" value="50" class="slider" id="speed-slider">
          <span id="speed-value">50%</span>
        </div>
        <div id="direction-pad" class="d-pad">
          <button class="dir-btn" data-dir="forward">‚Üë</button>
          <button class="dir-btn" data-dir="left">‚Üê</button>
          <button class="dir-btn" data-dir="stop">‚óè</button>
          <button class="dir-btn" data-dir="right">‚Üí</button>
          <button class="dir-btn" data-dir="backward">‚Üì</button>
        </div>
      </div>
      <div class="modal-actions">
        <button id="apply-controls" class="btn btn-primary">Apply</button>
        <button class="btn btn-secondary" data-close="controlModal">Close</button>
      </div>
    </div>
  </dialog>

  <script src="/static/js/dashboard-core.js"></script>
</body>
</html>